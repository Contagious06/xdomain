(function(e,t){(function(e,t){var n,r,o,i,s,a,u,f,c,d,l,p,h,v,g,y,m,x,b,w,E,k,L,T,C,R=[].indexOf||function(e){for(var t=0,n=this.length;n>t;t++)if(t in this&&this[t]===e)return t;return-1};x=e.document,r="before",n="after",l="readyState",d="addEventListener",c="removeEventListener",s="dispatchEvent",g="XMLHttpRequest",a="FormData",p=["load","loadend","loadstart"],o=["progress","abort","error","timeout"],E=parseInt((/msie (\d+)/.exec(navigator.userAgent.toLowerCase())||[])[1]),isNaN(E)&&(E=parseInt((/trident\/.*; rv:(\d+)/.exec(navigator.userAgent.toLowerCase())||[])[1])),(C=Array.prototype).indexOf||(C.indexOf=function(e){var t,n,r,o;for(t=r=0,o=this.length;o>r;t=++r)if(n=this[t],n===e)return t;return-1}),L=function(e,t){return Array.prototype.slice.call(e,t)},m=function(e){return"returnValue"===e||"totalSize"===e||"position"===e},w=function(e,t){var n,r;for(n in e)if(r=e[n],!m(n))try{t[n]=e[n]}catch(o){}return t},k=function(e,t,n){var r,o,i,a;for(o=function(e){return function(r){var o,i,a;o={};for(i in r)m(i)||(a=r[i],o[i]=a===t?n:a);return n[s](e,o)}},i=0,a=e.length;a>i;i++)r=e[i],n._has(r)&&(t["on"+r]=o(r))},b=function(e){var t;if(null!=x.createEventObject)return t=x.createEventObject(),t.type=e,t;try{return new Event(e)}catch(n){return{type:e}}},i=function(e){var n,r,o;return r={},o=function(e){return r[e]||[]},n={},n[d]=function(e,n,i){r[e]=o(e),r[e].indexOf(n)>=0||(i=i===t?r[e].length:i,r[e].splice(i,0,n))},n[c]=function(e,n){var i;return e===t?void(r={}):(n===t&&(r[e]=[]),i=o(e).indexOf(n),void(-1!==i&&o(e).splice(i,1)))},n[s]=function(){var r,i,s,a,u,f,c,d;for(r=L(arguments),i=r.shift(),e||(r[0]=w(r[0],b(i))),a=n["on"+i],a&&a.apply(t,r),d=o(i).concat(o("*")),s=f=0,c=d.length;c>f;s=++f)u=d[s],u.apply(t,r)},n._has=function(e){return!(!r[e]&&!n["on"+e])},e&&(n.listeners=function(e){return L(o(e))},n.on=n[d],n.off=n[c],n.fire=n[s],n.once=function(e,t){var r;return r=function(){return n.off(e,r),t.apply(null,arguments)},n.on(e,r)},n.destroy=function(){return r={}}),n},T=i(!0),T.EventEmitter=i,T[r]=function(e,t){if(e.length<1||e.length>2)throw"invalid hook";return T[d](r,e,t)},T[n]=function(e,t){if(e.length<2||e.length>3)throw"invalid hook";return T[d](n,e,t)},T.enable=function(){e[g]=v,u&&(e[a]=h)},T.disable=function(){e[g]=T[g],e[a]=u},y=T.headers=function(e,t){var n,r,o,i,s,a,u,f,c;switch(null==t&&(t={}),typeof e){case"object":r=[];for(o in e)s=e[o],i=o.toLowerCase(),r.push(""+i+":	"+s);return r.join("\n");case"string":for(r=e.split("\n"),u=0,f=r.length;f>u;u++)n=r[u],/([^:]+):\s*(.+)/.test(n)&&(i=null!=(c=RegExp.$1)?c.toLowerCase():void 0,a=RegExp.$2,null==t[i]&&(t[i]=a));return t}},u=e[a],h=function(e){var t;this.fd=e?new u(e):new u,this.form=e,t=[],Object.defineProperty(this,"entries",{get:function(){var n;return n=e?L(e.querySelectorAll("input,select")).filter(function(e){var t;return"checkbox"!==(t=e.type)&&"radio"!==t||e.checked}).map(function(e){return[e.name,"file"===e.type?e.files:e.value]}):[],n.concat(t)}}),this.append=function(e){return function(){var n;return n=L(arguments),t.push(n),e.fd.append.apply(e.fd,n)}}(this)},u&&(T[a]=u,e[a]=h),f=e[g],T[g]=f,v=e[g]=function(){var e,t,a,u,f,c,v,m,x,b,L,C,M,A,q,X,O;return e=-1,O=new T[g],b={},M=null,c=void 0,A=void 0,L=void 0,x=function(){var t,n,r,o;if(L.status=M||O.status,M===e&&10>E||(L.statusText=O.statusText),M!==e){o=y(O.getAllResponseHeaders());for(t in o)r=o[t],L.headers[t]||(n=t.toLowerCase(),L.headers[n]=r)}},m=function(){O.responseType&&"text"!==O.responseType?"document"===O.responseType?(L.xml=O.responseXML,L.data=O.responseXML):L.data=O.response:(L.text=O.responseText,L.data=O.responseText),"responseURL"in O&&(L.finalUrl=O.responseURL)},X=function(){f.status=L.status,f.statusText=L.statusText},q=function(){"text"in L&&(f.responseText=L.text),"xml"in L&&(f.responseXML=L.xml),"data"in L&&(f.response=L.data),"finalUrl"in L&&(f.responseURL=L.finalUrl)},u=function(e){for(;e>t&&4>t;)f[l]=++t,1===t&&f[s]("loadstart",{}),2===t&&X(),4===t&&(X(),q()),f[s]("readystatechange",{}),4===t&&setTimeout(a,0)},a=function(){c||f[s]("load",{}),f[s]("loadend",{}),c&&(f[l]=0)},t=0,C=function(e){var t,r;return 4!==e?void u(e):(t=T.listeners(n),r=function(){var e;return t.length?(e=t.shift(),2===e.length?(e(b,L),r()):3===e.length&&b.async?e(b,L,r):r()):u(4)},void r())},f=b.xhr=i(),O.onreadystatechange=function(e){try{2===O[l]&&x()}catch(t){}4===O[l]?(A=!1,x(),m()):3===O[l]&&(f.response=O.response,f.responseText=O.responseText,f.responseXML=O.responseXML),C(O[l])},v=function(){c=!0},f[d]("error",v),f[d]("timeout",v),f[d]("abort",v),f[d]("progress",function(){3>t?C(3):f[s]("readystatechange",{})}),("withCredentials"in O||T.addWithCredentials)&&(f.withCredentials=!1),f.status=0,f.open=function(e,n,r,o,i){t=0,c=!1,A=!1,b.headers={},b.headerNames={},b.status=0,L={},L.headers={},b.method=e,b.url=n,b.async=r!==!1,b.user=o,b.pass=i,C(1)},f.send=function(e){var t,n,i,s,a,u,c,d;for(d=["type","timeout","withCredentials"],u=0,c=d.length;c>u;u++)n=d[u],i="type"===n?"responseType":n,i in f&&(b[n]=f[i]);b.body=e,a=function(){var e,t,r,s,a,u;for(k(o,O,f),f.upload&&k(o.concat(p),O.upload,f.upload),A=!0,O.open(b.method,b.url,b.async,b.user,b.pass),a=["type","timeout","withCredentials"],r=0,s=a.length;s>r;r++)n=a[r],i="type"===n?"responseType":n,n in b&&(O[i]=b[n]);u=b.headers;for(e in u)t=u[e],O.setRequestHeader(e,t);b.body instanceof h&&(b.body=b.body.fd),O.send(b.body)},t=T.listeners(r),(s=function(){var e,n;return t.length?(e=function(e){return"object"!=typeof e||"number"!=typeof e.status&&"number"!=typeof L.status?void s():(w(e,L),R.call(e,"data")<0&&(e.data=e.response||e.text),void C(4))},e.head=function(e){return w(e,L),C(2)},e.progress=function(e){return w(e,L),C(3)},n=t.shift(),1===n.length?e(n(b)):2===n.length&&b.async?n(b,e):e()):a()})()},f.abort=function(){M=e,A?O.abort():f[s]("abort",{})},f.setRequestHeader=function(e,t){var n,r;n=null!=e?e.toLowerCase():void 0,r=b.headerNames[n]=b.headerNames[n]||e,b.headers[r]&&(t=b.headers[r]+", "+t),b.headers[r]=t},f.getResponseHeader=function(e){var t;return t=null!=e?e.toLowerCase():void 0,L.headers[t]},f.getAllResponseHeaders=function(){return y(L.headers)},O.overrideMimeType&&(f.overrideMimeType=function(){return O.overrideMimeType.apply(O,arguments)}),O.upload&&(f.upload=b.upload=i()),f},"function"==typeof this.define&&this.define.amd?define("xhook",[],function(){return T}):(this.exports||this).xhook=T}).call(this,e);var n,r,o,i,s,a,u,f,c,d,l,p,h,v,g,y,m,x,b,w,E,k,L,T,C,R,M,A,q,X,O,D,N,H,S,_,j,B,F;m=!1,A=function(e){var t,n;m||g();for(t in e)n=e[t],k("adding slave: "+t),A[t]=n},l={},p=function(e,t){var n;return l[e]?l[e]:(n=f.createElement("iframe"),n.id=n.name=h(),k("creating iframe "+n.id),n.src=""+e+t,n.setAttribute("style","display:none;"),f.body.appendChild(n),l[e]=n.contentWindow)},g=function(){var e,t,n;return m=!0,t=function(e,t){var n,r,o,i,s;return o=e[0],i=e[1],n=b(i,"Blob"),r=b(i,"File"),n||r?(s=new FileReader,s.onload=function(){return e[1]=null,r&&(e[2]=i.name),t(["XD_BLOB",e,this.result,i.type])},s.readAsArrayBuffer(i),1):0},e=function(e,n){var r;e.forEach(function(t,n){var r,o,i,s,a;if(o=t[0],i=t[1],b(i,"FileList"))for(e.splice(n,1),s=0,a=i.length;a>s;s++)r=i[s],e.splice(n,0,[o,r])}),r=0,e.forEach(function(o,i){r+=t(o,function(t){e[i]=t,0===--r&&n()})}),0===r&&n()},n=function(t,n){var r,o,i;return n.on("xhr-event",function(){return t.xhr.dispatchEvent.apply(null,arguments)}),n.on("xhr-upload-event",function(){return t.xhr.upload.dispatchEvent.apply(null,arguments)}),o=D(t),o.headers=t.headers,t.withCredentials&&(s.master&&(o.headers[s.master]=f.cookie),o.slaveCookie=s.slave),i=function(){return n.emit("request",o)},t.body&&(o.body=t.body,b(o.body,"FormData"))?(r=o.body.entries,o.body=["XD_FD",r],void e(r,i)):void i()},"addWithCredentials"in _||(_.addWithCredentials=!0),_.before(function(e,t){var r,o,i;return o=R(e.url),o&&o.origin!==u?A[o.origin]?(k("proxying request to slave: '"+o.origin+"'"),e.async===!1?(H("sync not supported"),t()):(r=p(o.origin,A[o.origin]),i=a(h(),r),i.on("response",function(e){return t(e),i.close()}),e.xhr.addEventListener("abort",function(){return i.emit("abort")}),void(i.ready?n(e,i):i.once("ready",function(){return n(e,i)})))):(o&&k("no slave matching: '"+o.origin+"'"),t()):t()})},x=!1,T=function(e){var t,n;x||y();for(t in e)n=e[t],k("adding master: "+t),T[t]=n},v=null,y=function(){return x=!0,k("handling incoming sockets..."),v=function(e,t){var n,r,o,i;"null"===e&&(e="*"),o=null;for(n in T){i=T[n];try{if(r=N(n),r.test(e)){o=N(i);break}}catch(s){}}return o?(t.once("request",function(e){var n,r,i,s,a,u,c,d,l,p,h;if(k("request: "+e.method+" "+e.url),u=R(e.url),!u||!o.test(u.path))return H("blocked request to path: '"+u.path+"' by regex: "+o),void t.close();d=new XMLHttpRequest,d.open(e.method,e.url),d.addEventListener("*",function(e){return t.emit("xhr-event",e.type,D(e))}),d.upload&&d.upload.addEventListener("*",function(e){return t.emit("xhr-upload-event",e.type,D(e))}),t.once("abort",function(){return d.abort()}),d.onreadystatechange=function(){var e;if(4===d.readyState){e={status:d.status,statusText:d.statusText,data:d.response,headers:_.headers(d.getAllResponseHeaders())};try{e.text=d.responseText}catch(n){}return t.emit("response",e)}},e.withCredentials&&(d.withCredentials=!0,e.slaveCookie&&(e.headers[e.slaveCookie]=f.cookie)),e.timeout&&(d.timeout=e.timeout),e.type&&(d.responseType=e.type),h=e.headers;for(a in h)c=h[a],d.setRequestHeader(a,c);if(e.body instanceof Array&&"XD_FD"===e.body[0]){for(s=new _.FormData,i=e.body[1],l=0,p=i.length;p>l;l++)n=i[l],"XD_BLOB"===n[0]&&4===n.length&&(r=new Blob([n[2]],{type:n[3]}),n=n[1],n[1]=r),s.append.apply(s,n);e.body=s}d.send(e.body||null)}),void k("slave listening for requests on socket: "+t.id)):void H("blocked request from: '"+e+"'")},e===e.parent?H("slaves must be in an iframe"):e.parent.postMessage("XDPING_"+r,"*")},o="XD_CHECK",X={},w=!0,a=function(e,t){var r,i,s,a,u,f;return u=!1,f=X[e]=_.EventEmitter(!0),f.id=e,f.once("close",function(){return f.destroy(),f.close()}),a=[],f.emit=function(){var t,n;t=q(arguments),n="string"==typeof t[1]?" -> "+t[1]:"",k("send socket: "+e+": "+t[0]+n),t.unshift(e),u?s(t):a.push(t)},s=function(e){w&&(e=JSON.stringify(e)),t.postMessage(e,"*")},f.close=function(){f.emit("close"),k("close socket: "+e),X[e]=null},f.once(o,function(t){for(w="string"==typeof t,u=f.ready=!0,f.emit("ready"),k("ready socket: "+e+" (emit #"+a.length+" pending)");a.length;)s(a.shift())}),i=0,r=function(s){return function(){t.postMessage([e,o,{}],"*"),u||(i++>=S.timeout/n?(H("Timeout waiting on iframe socket"),c.fire("timeout"),f.fire("abort")):setTimeout(r,n))}}(this),setTimeout(r),k("new socket: "+e),f},C=function(t){return f.addEventListener?e.addEventListener("message",t):e.attachEvent("onmessage",t)},O=function(){return C(function(e){var n,o,i,s;if(n=e.data,"string"==typeof n){if(/^XDPING(_(V\d+))?$/.test(n)&&RegExp.$2!==r)return H("your master is not compatible with your slave, check your xdomain.js version");if(/^xdomain-/.test(n))n=n.split(",");else if(w)try{n=JSON.parse(n)}catch(u){return}}if(n instanceof Array&&(i=n.shift(),/^xdomain-/.test(i)&&(s=X[i],null!==s))){if(s===t){if(!v)return;s=a(i,e.source),v(e.origin,s)}o="string"==typeof n[1]?" -> "+n[1]:"",k("receive socket: "+i+": "+n[0]+o),s.fire.apply(s,n)}})},_=(this.exports||this).xhook,S=function(e){e&&(e.masters&&T(e.masters),e.slaves&&A(e.slaves))},S.masters=T,S.slaves=A,S.debug=!1,S.timeout=15e3,n=100,s=S.cookies={master:"Master-Cookie",slave:"Slave-Cookie"},f=e.document,E=e.location,u=S.origin=E.protocol+"//"+E.host,h=function(){return"xdomain-"+Math.round(Math.random()*Math.pow(2,32)).toString(16)},q=function(e,t){return Array.prototype.slice.call(e,t)},i=e.console||{},c=null,M=function(){c=_.EventEmitter(!0),S.on=c.on,S.off=c.off},_&&M(),L=function(e){return function(t){t="xdomain ("+u+"): "+t,c.fire(e,t),("log"!==e||S.debug)&&(e in S?S[e](t):e in i?i[e](t):"warn"===e&&alert(t))}},k=L("log"),H=L("warn"),F=["postMessage","JSON"];for(j=0,B=F.length;B>j;j++)if(d=F[j],!e[d])return void H("requires '"+d+"' and this browser does not support it");b=function(t,n){return n in e?t instanceof e[n]:!1},r="V1",R=S.parseUrl=function(e){return/^((https?:)?\/\/[^\/\?]+)(\/.*)?/.test(e)?{origin:(RegExp.$2?"":E.protocol)+RegExp.$1,path:RegExp.$3}:(k("failed to parse absolute url: "+e),null)},N=function(e){var t;return e instanceof RegExp?e:(t=e.toString().replace(/\W/g,function(e){return"\\"+e}).replace(/\\\*/g,".*"),new RegExp("^"+t+"$"))},D=function(e){var t,n,r,o;t={};for(n in e)"returnValue"!==n&&(r=e[n],"function"!=(o=typeof r)&&"object"!==o&&(t[n]=r));return t},function(){var e,t,n,r,o,i,s,a,u,c,d;for(e={debug:function(e){return"string"==typeof e?S.debug="false"!==e:void 0},slave:function(e){var t,n;if(e&&(t=R(e)))return n={},n[t.origin]=t.path,A(n)},master:function(e){var t,n;if(e&&(n="*"===e?{origin:"*",path:"*"}:R(e)))return t={},t[n.origin]=n.path.replace(/^\//,"")?n.path:"*",T(t)}},c=f.getElementsByTagName("script"),i=0,a=c.length;a>i;i++)if(o=c[i],/xdomain/.test(o.src))for(d=["","data-"],s=0,u=d.length;u>s;s++){r=d[s];for(n in e)(t=e[n])(o.getAttribute(r+n))}}(),O(),"function"==typeof this.define&&this.define.amd?define("xdomain",["xhook"],function(e){return _=e,M(),S}):(this.exports||this).xdomain=S}).call(this,window);